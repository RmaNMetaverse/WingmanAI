<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wingman AI</title>
    
    <!-- PWA Manifest Link -->
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Wingman AI">
    
    <!-- Theme Color for Mobile Browsers -->
    <meta name="theme-color" content="#121212">

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Font: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            /* Prevent pull-to-refresh on mobile which feels web-like */
            overscroll-behavior-y: none;
        }
        .glass-panel {
            background: rgba(30, 30, 30, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e1e1e; 
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; 
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">

    const { useState, useEffect, useRef } = React;

    // --- Components ---

    const TabButton = ({ active, onClick, icon, label }) => (
        <button 
            onClick={onClick}
            className={`flex-1 py-4 text-center transition-all duration-300 border-b-2 ${
                active 
                ? 'border-indigo-500 text-indigo-400 bg-white/5' 
                : 'border-transparent text-gray-400 hover:text-gray-200 hover:bg-white/5'
            }`}
        >
            <i className={`fa-solid ${icon} mb-1 block text-lg`}></i>
            <span className="text-xs uppercase tracking-wider font-semibold">{label}</span>
        </button>
    );

    const SuggestionCard = ({ title, text, onCopy }) => (
        <div className="bg-gray-800/50 border border-gray-700 rounded-lg p-4 mb-3 hover:border-indigo-500/50 transition-colors group relative">
            <div className="flex justify-between items-start mb-2">
                <span className="text-xs font-bold text-indigo-400 uppercase tracking-wide">{title}</span>
                <button 
                    onClick={() => onCopy(text)}
                    className="text-gray-500 hover:text-white transition-colors"
                    title="Copy to clipboard"
                >
                    <i className="fa-regular fa-copy"></i>
                </button>
            </div>
            <p className="text-gray-200 text-sm leading-relaxed whitespace-pre-wrap">{text}</p>
        </div>
    );

    const LanguageCheckbox = ({ lang, selected, toggle }) => (
        <div 
            onClick={() => toggle(lang)}
            className={`cursor-pointer px-3 py-2 rounded border text-xs font-medium transition-all ${
                selected 
                ? 'bg-indigo-600 border-indigo-500 text-white' 
                : 'bg-gray-800 border-gray-700 text-gray-400 hover:border-gray-500'
            }`}
        >
            {lang} {selected && <i className="fa-solid fa-check ml-1"></i>}
        </div>
    );

    const SetupBanner = ({ onGoToSettings }) => (
        <div className="bg-indigo-900/30 border border-indigo-500/30 rounded-lg p-4 mb-4 flex items-start gap-3 animate-pulse">
            <div className="bg-indigo-500/20 p-2 rounded-full shrink-0">
                 <i className="fa-solid fa-key text-indigo-400"></i>
            </div>
            <div>
                <h4 className="text-indigo-300 text-xs font-bold uppercase mb-1">Setup Required</h4>
                <p className="text-gray-400 text-xs mb-2">You need a free Google Gemini API key to generate responses.</p>
                <button 
                    onClick={onGoToSettings}
                    className="text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded transition-colors font-medium"
                >
                    Go to Settings
                </button>
            </div>
        </div>
    );

    const LanguageShortcut = ({ langs, onGoToSettings }) => (
        <div className="flex justify-between items-center px-1 mb-1 mt-1">
             <div className="text-[10px] text-gray-500 uppercase font-semibold tracking-wider">
                Output Language{langs.length > 1 ? 's' : ''}
             </div>
             <button 
                onClick={onGoToSettings} 
                className="text-[10px] text-indigo-400 hover:text-indigo-300 flex items-center gap-1 transition-colors bg-indigo-500/10 px-2 py-1 rounded border border-indigo-500/20"
                title="Change languages in Settings"
            >
                <i className="fa-solid fa-globe"></i>
                {langs.join(', ')}
                <i className="fa-solid fa-pencil text-[8px] ml-1"></i>
             </button>
        </div>
    );

    // Image Upload Component
    const ImageUploader = ({ images, onUpload, onRemove, label }) => {
        const fileInputRef = useRef(null);

        return (
            <div className="mb-4">
                <label className="block text-xs font-semibold text-gray-400 uppercase mb-2 ml-1">{label}</label>
                
                {/* Image Grid */}
                {images.length > 0 && (
                    <div className="flex gap-2 mb-3 overflow-x-auto pb-2">
                        {images.map((img, idx) => (
                            <div key={idx} className="relative w-16 h-20 shrink-0 rounded-lg overflow-hidden border border-gray-700 group">
                                <img src={img.data} className="w-full h-full object-cover" />
                                <button 
                                    onClick={() => onRemove(idx)}
                                    className="absolute top-0 right-0 bg-red-500/80 text-white w-5 h-5 flex items-center justify-center rounded-bl text-xs opacity-0 group-hover:opacity-100 transition-opacity"
                                >
                                    <i className="fa-solid fa-xmark"></i>
                                </button>
                            </div>
                        ))}
                    </div>
                )}

                {/* Upload Button */}
                {images.length < 5 && (
                    <div 
                        onClick={() => fileInputRef.current.click()}
                        className="border-2 border-dashed border-gray-700 hover:border-indigo-500/50 bg-gray-800/30 rounded-lg p-4 text-center cursor-pointer transition-colors group"
                    >
                        <i className="fa-solid fa-images text-gray-500 group-hover:text-indigo-400 text-xl mb-2"></i>
                        <p className="text-xs text-gray-400 group-hover:text-gray-300">
                            Click to upload screenshots <br/> 
                            <span className="text-[10px] text-gray-600">(Max 5) or <span className="text-indigo-400 font-bold">Ctrl+V</span> to paste</span>
                        </p>
                        <input 
                            type="file" 
                            ref={fileInputRef} 
                            onChange={onUpload} 
                            className="hidden" 
                            accept="image/*" 
                            multiple
                        />
                    </div>
                )}
            </div>
        );
    };

    function App() {
        // --- State ---
        const [activeTab, setActiveTab] = useState('opener'); 
        const [apiKey, setApiKey] = useState('');
        const [loading, setLoading] = useState(false);
        const [error, setError] = useState('');
        const [suggestions, setSuggestions] = useState([]);
        const [vibeAnalysis, setVibeAnalysis] = useState('');
        
        // Settings State
        const [selectedLangs, setSelectedLangs] = useState(['English']);
        const AVAILABLE_LANGS = ['English', 'Spanish', 'Farsi', 'French', 'German', 'Portuguese', 'Italian', 'Russian', 'Japanese', 'Chinese'];

        // Opener Inputs
        const [herBio, setHerBio] = useState('');
        const [herInterests, setHerInterests] = useState('');
        const [openerImages, setOpenerImages] = useState([]); // Array of { data: base64, mime: type }
        
        // Reply Inputs
        const [chatHistory, setChatHistory] = useState('');
        const [replyImages, setReplyImages] = useState([]);
        const [myVibe, setMyVibe] = useState('Funny & Witty');

        // Load API Key from localStorage on mount
        useEffect(() => {
            const storedKey = localStorage.getItem('gemini_api_key');
            if (storedKey) setApiKey(storedKey);
            
            const storedLangs = localStorage.getItem('wingman_langs');
            if (storedLangs) setSelectedLangs(JSON.parse(storedLangs));
        }, []);

        // Save API Key
        const handleSaveKey = (key) => {
            setApiKey(key);
            localStorage.setItem('gemini_api_key', key);
        };

        const toggleLanguage = (lang) => {
            let newLangs;
            if (selectedLangs.includes(lang)) {
                if (selectedLangs.length === 1) return; 
                newLangs = selectedLangs.filter(l => l !== lang);
            } else {
                if (selectedLangs.length >= 3) return; 
                newLangs = [...selectedLangs, lang];
            }
            setSelectedLangs(newLangs);
            localStorage.setItem('wingman_langs', JSON.stringify(newLangs));
        };

        // --- Image Handling ---

        // Handle Paste Events (Ctrl+V)
        useEffect(() => {
            const handlePaste = (e) => {
                // Only handle paste if we are in opener or reply tab
                if (activeTab !== 'opener' && activeTab !== 'reply') return;

                const items = e.clipboardData.items;
                let foundImage = false;

                for (let i = 0; i < items.length; i++) {
                    if (items[i].type.indexOf('image') !== -1) {
                        foundImage = true;
                        const file = items[i].getAsFile();
                        const reader = new FileReader();
                        
                        reader.onloadend = () => {
                            const setter = activeTab === 'opener' ? setOpenerImages : setReplyImages;
                            setter(prev => {
                                if (prev.length >= 5) return prev; // Respect limit
                                return [...prev, {
                                    data: reader.result,
                                    mime: file.type
                                }];
                            });
                        };
                        reader.readAsDataURL(file);
                    }
                }

                // If we found an image, prevent it from pasting into text fields if any are focused
                if (foundImage) {
                    e.preventDefault();
                }
            };

            window.addEventListener('paste', handlePaste);
            return () => window.removeEventListener('paste', handlePaste);
        }, [activeTab]);

        const handleImageUpload = (e, setImages, currentImages) => {
            const files = Array.from(e.target.files);
            const remainingSlots = 5 - currentImages.length;
            const filesToProcess = files.slice(0, remainingSlots);

            filesToProcess.forEach(file => {
                const reader = new FileReader();
                reader.onloadend = () => {
                    setImages(prev => [...prev, {
                        data: reader.result,
                        mime: file.type
                    }]);
                };
                reader.readAsDataURL(file);
            });
            // Reset input so same file can be selected again if needed
            e.target.value = '';
        };

        const removeImage = (index, setImages) => {
            setImages(prev => prev.filter((_, i) => i !== index));
        };

        // --- Logic ---

        const copyToClipboard = (text) => {
            navigator.clipboard.writeText(text);
        };

        const generateContent = async () => {
            if (!apiKey) {
                setError("Please enter your Gemini API Key in Settings.");
                setActiveTab('settings');
                return;
            }
            
            setLoading(true);
            setError('');
            setSuggestions([]);
            setVibeAnalysis('');

            const langInstruction = `Please provide the output in the following languages: ${selectedLangs.join(', ')}. 
            If multiple languages are listed, provide the English version first, followed immediately by the translations.`;

            let systemInstruction = "";
            let userPromptText = "";
            let imagesToSend = [];

            // --- BUILD PROMPT BASED ON TAB ---

            if (activeTab === 'opener') {
                systemInstruction = `You are an expert dating coach. 
                Your goal is to write perfect opening messages based on the user's input (Bio/Context text OR Profile Screenshots).
                
                Guidelines:
                1. If images are provided, ANALYZE THEM VISUALLY. Look for hobbies in photos, read the bio text in the screenshot, identify travel spots, pets, or funny details.
                2. Create 3 DISTINCT options.
                3. Option 1: "Playful/Funny" (Use humor, maybe a light tease).
                4. Option 2: "Observational" (Focus on visual details from photos or specific bio points).
                5. Option 3: "Bold/Direct" (Confident, showing intent).
                6. Keep them short. No "Hey" or generic greetings.
                7. My Vibe: ${myVibe}
                8. ${langInstruction}`;

                userPromptText = `Her Bio (Text): "${herBio}"
                Context (Text): "${herInterests}"
                
                (Note: If I attached images, prioritize the visual info and text inside those screenshots)`;
                imagesToSend = openerImages;

            } else {
                systemInstruction = `You are an expert dating coach. 
                Your goal is to write a reply to an ongoing conversation based on the text history or chat screenshots.
                
                Guidelines:
                1. If images are provided, READ THE CHAT LOGS in the screenshots carefully to understand context, tone, and the last message sent.
                2. FIRST: Analyze the conversation. Suggest which 'Vibe' is best. Label this "VIBE CHECK".
                3. THEN: Create 3 DISTINCT reply options based on my selected vibe: ${myVibe}.
                4. Option 1: "Keep it flowing".
                5. Option 2: "Escalate/Flirt".
                6. Option 3: "The Close" (Ask for date/number).
                7. ${langInstruction}`;

                userPromptText = `Chat History (Text):
                ---
                ${chatHistory}
                ---
                
                (Note: If I attached screenshots, read the chat bubbles in them to get the history)`;
                imagesToSend = replyImages;
            }

            // --- CONSTRUCT API PAYLOAD ---

            // 1. Text Part
            const contentParts = [{ text: userPromptText }];

            // 2. Image Parts
            imagesToSend.forEach(img => {
                // Remove the "data:image/png;base64," prefix for the API
                const base64Data = img.data.split(',')[1];
                contentParts.push({
                    inline_data: {
                        mime_type: img.mime,
                        data: base64Data
                    }
                });
            });

            try {
                // Using gemini-2.5-flash which supports multimodal input
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ 
                            role: "user",
                            parts: contentParts 
                        }],
                        system_instruction: { parts: [{ text: systemInstruction }] },
                        generationConfig: { temperature: 0.8, maxOutputTokens: 8192 },
                        safetySettings: [
                            { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_ONLY_HIGH" },
                            { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_ONLY_HIGH" },
                            { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_ONLY_HIGH" },
                            { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_ONLY_HIGH" }
                        ]
                    })
                });

                if (!response.ok) {
                    const errData = await response.json();
                    throw new Error(errData.error?.message || 'API Request Failed');
                }

                const data = await response.json();
                
                if (!data.candidates || data.candidates.length === 0) {
                    throw new Error("The AI returned no response. This usually happens if the input was flagged by safety filters.");
                }

                const candidate = data.candidates[0];
                
                if (!candidate.content || !candidate.content.parts || !candidate.content.parts[0]) {
                     if (candidate.finishReason === 'SAFETY') {
                         throw new Error("Blocked by Safety Filters. Try cropping the image to remove sensitive parts or rephrasing.");
                     }
                     if (candidate.finishReason === 'MAX_TOKENS') {
                         throw new Error("Response Too Long. The AI tried to write more than the limit allows.");
                     }
                     throw new Error(`The AI response was empty. Reason: ${candidate.finishReason || 'Unknown'}`);
                }

                let rawText = candidate.content.parts[0].text;
                
                // Parsing Vibe Check
                if (rawText.includes("VIBE CHECK")) {
                    const parts = rawText.split(/VIBE CHECK:?/i);
                    if (parts.length > 1) {
                         const analysisEnd = parts[1].search(/(Option 1|1\.|Here are)/i);
                         if (analysisEnd !== -1) {
                             setVibeAnalysis(parts[1].substring(0, analysisEnd).trim());
                             rawText = parts[1].substring(analysisEnd).trim();
                         } else {
                             rawText = parts[1]; 
                         }
                    }
                }

                setSuggestions([{ title: "Response Options", text: rawText }]);

            } catch (err) {
                setError(err.message);
            } finally {
                setLoading(false);
            }
        };

        // --- Render ---

        return (
            <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-gray-900 via-gray-900 to-indigo-950">
                <div className="w-full max-w-md glass-panel rounded-2xl shadow-2xl overflow-hidden flex flex-col h-[90vh]">
                    
                    {/* Header */}
                    <header className="p-4 border-b border-gray-700 bg-black/20 flex justify-between items-center">
                        <div className="flex items-center gap-2">
                            <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500 flex items-center justify-center shadow-lg shadow-indigo-500/20">
                                <i className="fa-solid fa-wind text-white text-sm"></i>
                            </div>
                            <h1 className="text-xl font-bold tracking-tight text-white">Wingman AI</h1>
                        </div>
                        <div className={`w-2 h-2 rounded-full ${apiKey ? 'bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]' : 'bg-red-500'}`} title={apiKey ? "API Key Connected" : "No API Key"}></div>
                    </header>

                    {/* Navigation */}
                    <div className="flex bg-black/20">
                        <TabButton active={activeTab === 'opener'} onClick={() => setActiveTab('opener')} icon="fa-magic" label="Openers" />
                        <TabButton active={activeTab === 'reply'} onClick={() => setActiveTab('reply')} icon="fa-comments" label="Replies" />
                        <TabButton active={activeTab === 'settings'} onClick={() => setActiveTab('settings')} icon="fa-gear" label="Settings" />
                    </div>

                    {/* Main Content Area */}
                    <div className="flex-1 overflow-y-auto p-5 relative">
                        
                        {error && (
                            <div className="mb-4 p-3 bg-red-500/10 border border-red-500/50 rounded text-red-200 text-sm flex items-center gap-2">
                                <i className="fa-solid fa-circle-exclamation"></i>
                                {error}
                            </div>
                        )}

                        {/* --- OPENER TAB --- */}
                        {activeTab === 'opener' && (
                            <div className="space-y-4 animate-fade-in">
                                {!apiKey && <SetupBanner onGoToSettings={() => setActiveTab('settings')} />}
                                {apiKey && <LanguageShortcut langs={selectedLangs} onGoToSettings={() => setActiveTab('settings')} />}

                                {/* Image Upload for Opener */}
                                <ImageUploader 
                                    label="Upload Profile Screenshots" 
                                    images={openerImages} 
                                    onUpload={(e) => handleImageUpload(e, setOpenerImages, openerImages)} 
                                    onRemove={(idx) => removeImage(idx, setOpenerImages)}
                                />

                                <div className="relative border-t border-gray-700/50 pt-4 mt-2">
                                    <span className="absolute -top-3 left-1/2 -translate-x-1/2 bg-[#1b1b1e] px-2 text-[10px] text-gray-500 font-bold uppercase tracking-widest">OR Text Input</span>
                                </div>

                                <div>
                                    <label className="block text-xs font-semibold text-gray-400 uppercase mb-2 ml-1">Her Bio (Optional)</label>
                                    <textarea 
                                        className="w-full bg-gray-800/50 border border-gray-700 rounded-lg p-3 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 resize-none h-20"
                                        placeholder="Paste bio here if not in screenshots..."
                                        value={herBio}
                                        onChange={(e) => setHerBio(e.target.value)}
                                    ></textarea>
                                </div>
                                <div>
                                    <label className="block text-xs font-semibold text-gray-400 uppercase mb-2 ml-1">Context / Photos (Optional)</label>
                                    <input 
                                        type="text" 
                                        className="w-full bg-gray-800/50 border border-gray-700 rounded-lg p-3 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"
                                        placeholder="Extra details..."
                                        value={herInterests}
                                        onChange={(e) => setHerInterests(e.target.value)}
                                    />
                                </div>
                                <div className="pt-2">
                                    <label className="block text-xs font-semibold text-gray-400 uppercase mb-2 ml-1">My Vibe</label>
                                    <select 
                                        value={myVibe}
                                        onChange={(e) => setMyVibe(e.target.value)}
                                        className="w-full bg-gray-800/50 border border-gray-700 rounded-lg p-3 text-sm text-white focus:outline-none focus:border-indigo-500"
                                    >
                                        <option>Funny & Witty</option>
                                        <option>Direct & Confident</option>
                                        <option>Casual & Low-key</option>
                                        <option>Intellectual & Deep</option>
                                        <option>Flirty & Playful</option>
                                        <option>Sexting (Spicy)</option>
                                    </select>
                                </div>
                            </div>
                        )}

                        {/* --- REPLY TAB --- */}
                        {activeTab === 'reply' && (
                            <div className="space-y-4 animate-fade-in">
                                {!apiKey && <SetupBanner onGoToSettings={() => setActiveTab('settings')} />}
                                {apiKey && <LanguageShortcut langs={selectedLangs} onGoToSettings={() => setActiveTab('settings')} />}
                                
                                {/* Image Upload for Reply */}
                                <ImageUploader 
                                    label="Upload Chat Screenshots" 
                                    images={replyImages} 
                                    onUpload={(e) => handleImageUpload(e, setReplyImages, replyImages)} 
                                    onRemove={(idx) => removeImage(idx, setReplyImages)}
                                />

                                <div className="relative border-t border-gray-700/50 pt-4 mt-2">
                                    <span className="absolute -top-3 left-1/2 -translate-x-1/2 bg-[#1b1b1e] px-2 text-[10px] text-gray-500 font-bold uppercase tracking-widest">OR Text Input</span>
                                </div>

                                <div>
                                    <label className="block text-xs font-semibold text-gray-400 uppercase mb-2 ml-1">Chat History (Optional)</label>
                                    <textarea 
                                        className="w-full bg-gray-800/50 border border-gray-700 rounded-lg p-3 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 resize-none h-24 font-mono"
                                        placeholder={`Type history if not using screenshots...`}
                                        value={chatHistory}
                                        onChange={(e) => setChatHistory(e.target.value)}
                                    ></textarea>
                                </div>
                                <div className="pt-2">
                                    <label className="block text-xs font-semibold text-gray-400 uppercase mb-2 ml-1">My Vibe</label>
                                    <select 
                                        value={myVibe}
                                        onChange={(e) => setMyVibe(e.target.value)}
                                        className="w-full bg-gray-800/50 border border-gray-700 rounded-lg p-3 text-sm text-white focus:outline-none focus:border-indigo-500"
                                    >
                                        <option>Funny & Witty</option>
                                        <option>Direct & Confident</option>
                                        <option>Casual & Low-key</option>
                                        <option>Intellectual & Deep</option>
                                        <option>Flirty & Playful</option>
                                        <option>Sexting (Spicy)</option>
                                    </select>
                                </div>
                            </div>
                        )}

                        {/* --- SETTINGS TAB --- */}
                        {activeTab === 'settings' && (
                            <div className="space-y-6 animate-fade-in">
                                <div>
                                    <label className="block text-xs font-semibold text-gray-400 uppercase mb-2 ml-1">Gemini API Key</label>
                                    <div className="relative">
                                        <input 
                                            type="password" 
                                            className="w-full bg-gray-800/50 border border-gray-700 rounded-lg p-3 pl-10 text-sm text-white placeholder-gray-600 focus:outline-none focus:border-indigo-500"
                                            placeholder="Paste Key Here..."
                                            value={apiKey}
                                            onChange={(e) => handleSaveKey(e.target.value)}
                                        />
                                        <i className="fa-solid fa-key absolute left-3 top-3.5 text-gray-600"></i>
                                    </div>
                                    <p className="text-[10px] text-gray-500 mt-2 ml-1">Key is saved locally in your browser.</p>
                                </div>

                                <div className="bg-gray-800/30 border border-gray-700 rounded-lg p-4">
                                    <label className="block text-xs font-semibold text-indigo-400 uppercase mb-3">Output Languages (Max 3)</label>
                                    <div className="flex flex-wrap gap-2">
                                        {AVAILABLE_LANGS.map(lang => (
                                            <LanguageCheckbox 
                                                key={lang} 
                                                lang={lang} 
                                                selected={selectedLangs.includes(lang)}
                                                toggle={toggleLanguage}
                                            />
                                        ))}
                                    </div>
                                    <p className="text-[10px] text-gray-500 mt-2">AI will generate content in all selected languages.</p>
                                </div>
                            </div>
                        )}

                        {/* --- OUTPUT AREA --- */}
                        {(activeTab !== 'settings') && (vibeAnalysis || suggestions.length > 0) && (
                            <div className="mt-6 border-t border-gray-700 pt-6 animate-slide-up pb-4">
                                
                                {vibeAnalysis && (
                                    <div className="bg-indigo-900/20 border border-indigo-500/30 rounded-lg p-3 mb-4">
                                        <h4 className="text-indigo-300 text-xs font-bold uppercase mb-1">
                                            <i className="fa-solid fa-stethoscope mr-1"></i> Vibe Check
                                        </h4>
                                        <p className="text-gray-300 text-sm italic">{vibeAnalysis}</p>
                                    </div>
                                )}

                                <h3 className="text-gray-400 text-xs font-bold uppercase mb-3 flex items-center gap-2">
                                    <i className="fa-solid fa-bolt text-indigo-500"></i> Suggestions
                                </h3>
                                {suggestions.map((s, i) => (
                                    <SuggestionCard key={i} title={s.title} text={s.text} onCopy={copyToClipboard} />
                                ))}
                            </div>
                        )}
                        
                    </div>

                    {/* Footer / Action Button */}
                    {activeTab !== 'settings' && (
                        <div className="p-4 border-t border-gray-700 bg-black/40">
                            <button 
                                onClick={generateContent}
                                disabled={loading || !apiKey}
                                className={`w-full py-3.5 rounded-lg font-bold text-sm uppercase tracking-wide transition-all shadow-lg flex items-center justify-center gap-2
                                    ${loading 
                                        ? 'bg-gray-700 text-gray-400 cursor-not-allowed' 
                                        : !apiKey 
                                            ? 'bg-gray-800 text-gray-500 hover:bg-gray-700'
                                            : 'bg-indigo-600 hover:bg-indigo-500 text-white shadow-indigo-500/25 hover:shadow-indigo-500/40'
                                    }`}
                            >
                                {loading ? (
                                    <>
                                        <i className="fa-solid fa-circle-notch fa-spin"></i> Analyzing...
                                    </>
                                ) : !apiKey ? (
                                    <>Set API Key First</>
                                ) : (
                                    <>
                                        <i className="fa-solid fa-wand-magic-sparkles"></i> Generate
                                    </>
                                )}
                            </button>
                        </div>
                    )}
                </div>
            </div>
        );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

    // --- Service Worker Registration ---
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(req => console.log('Service Worker Registered!'))
                .catch(err => console.log('Service Worker Failed', err));
        });
    }

</script>
</body>
</html>